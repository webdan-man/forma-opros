$(document).ready(function(){function a(a,t){var e="[data-step="+a+"]";console.log(n[a-1]),n[a-1][1]&&a>1&&6>a&&(e+="[data-otvet="+n[a-1][1]+"]"),n[a-1][2]&&(e+="[data-var="+n[a-1][2]+"]"),1==t?$(".sec.active").removeClass("active"):$(".sec.active").removeClass("active").addClass("disactive"),$(".sec"+e).removeClass("disactive").addClass("active"),1==a&&(n=[[1],[2],[3],[4],[5],[6],[7],[8]]),$("#opros-wrap").attr("data-step",a),$("#step-data").html(a)}function t(a,t){var e="[data-fact="+a+"]";1==t?$(".fact.active").removeClass("active"):$(".fact.active").removeClass("active").addClass("disactive"),$(".fact"+e).removeClass("disactive").addClass("active")}function e(a,t){var e="[data-etap="+a+"]";1==t?$(".etap.active").removeClass("active"):$(".etap.active").removeClass("active").addClass("disactive"),$(".etap"+e).removeClass("disactive").addClass("active"),$('.etaps[data-etaps="1"]').attr("data-etap",a)}function s(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function i(a){$.ajax({type:"GET",url:a,dataType:"xml",success:function(a){$(a).find("ip").each(function(){var a=$(this).find("city").text(),t=$(this).find("region").text();if(a!=t)var e=a+", "+t;else var e=a;$('<input type="hidden" />').attr({name:"location","class":"location",value:e}).appendTo("form")})}})}var n=[[1],[2],[3],[4],[5],[6],[7],[8]];window.downloadFile=function(a){if(window.downloadFile.isChrome||window.downloadFile.isSafari){var t=document.createElement("a");if(t.href=a,void 0!==t.download){var e=a.substring(a.lastIndexOf("/")+1,a.length);t.download=e}if(document.createEvent){var s=document.createEvent("MouseEvents");return s.initEvent("click",!0,!0),t.dispatchEvent(s),!0}}var i="?download";window.open(a+i,"_self")},window.downloadFile.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,window.downloadFile.isSafari=navigator.userAgent.toLowerCase().indexOf("safari")>-1,$(".btn_gr a:not(.site-link)").click(function(s){if(s.preventDefault(),$(this).hasClass("otvet"))for(var i=n.length-1;i>0;i--)n[i][1]=parseInt($(this).data("otvet"));if($(this).hasClass("var")&&(n[parseInt($(this).data("nextstep"))-1][2]=parseInt($(this).data("var"))),$(".download").click(function(){window.downloadFile($(this).attr("data-download"))}),$(this).hasClass("fact-btn"))t(parseInt($(this).data("nextfact")));else if($(this).hasClass("show-etap"))$('.etaps[data-etaps="0"]').removeClass("active").addClass("disactive"),$('.etaps[data-etaps="1"]').addClass("active");else if($(this).hasClass("fins-btn"))$('.fins[data-fins="0"]').removeClass("active").addClass("disactive"),$('.fins[data-fins="'+$(this).data("fins")+'"]').addClass("active");else if($(this).hasClass("next-etap"))e(parseInt($(this).data("nextetap")));else if($(this).hasClass("download"))window.downloadFile("ajax/Предложение от Gulfstream.pdf");else{var o=parseInt($(this).data("nextstep")),d=o-1;5>d&&$('input.step-inp[data-step="'+d+'"]').val($(this).text()),a(parseInt($(this).data("nextstep")))}}),$(".back").click(function(s){s.preventDefault(),$(this).hasClass("back-fact")?t(parseInt($(this).data("prevfact")),1):$(this).hasClass("hide-etap")?($('.etaps[data-etaps="1"]').removeClass("active"),$('.etaps[data-etaps="0"]').removeClass("disactive").addClass("active")):$(this).hasClass("back-fins")?($(".fins.active").removeClass("active"),$('.fins[data-fins="0"]').removeClass("disactive").addClass("active")):$(this).hasClass("close-ok")?($('.fins[data-fins="2"]').addClass("active"),$(".okgo").removeClass("active")):$(this).hasClass("back-etap")?e(parseInt($(this).data("prevetap")),1):a(parseInt($(this).data("prevstep")),1)}),$.get("http://ipinfo.io",function(a){geo_url="http://ipgeobase.ru:7020/geo?ip="+a.ip,i(geo_url)},"jsonp"),utm=[],$.each(["utm_source","utm_medium","utm_campaign","utm_term","source_type","source","position_type","position","added","creative","matchtype"],function(a,t){$('<input type="hidden" />').attr({name:t,"class":t,value:function(){return void 0==s(t)?"-":s(t)}}).appendTo("form")}),$('<input type="hidden" />').attr({name:"url",value:document.location.href}).appendTo("form"),$('<input type="hidden" />').attr({name:"title",value:document.title}).appendTo("form"),$('input[name="name"]').blur(function(){$(this).val().length<3&&$(this).addClass("error-input")}),$('input[name="name"]').focus(function(){$(this).removeClass("error-input")}),$('input[name="phone"]').mask("+7 (999) 999-99-99"),$('input[name="phone"]').blur(function(){18!=$(this).val().length&&$(this).addClass("error-input")}),$('input[name="phone"]').focus(function(){$(this).removeClass("error-input")}),$(".line").swipe({swipe:function(a,t){"left"===t&&(console.log("left"),$(".etap.active a.back-etap").trigger("click")),"right"===t&&(console.log("right"),$(".etap.active a.next-etap").trigger("click"))},excludedElements:[]}),$("form").submit(function(a){if(a.preventDefault(),$(this).find('input[type="text"]').trigger("blur"),!$(this).find('input[type="text"]').hasClass("error-input")){var t=$(this).attr("method"),e=$(this).attr("action"),s=$(this).serialize();$.ajax({type:t,url:e,data:s,success:function(){$('.fins[data-fins="2"]').removeClass("active"),$(".okgo").addClass("active")}})}})});